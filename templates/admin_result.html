<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>判卷详情</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='ui.css') }}" />
    <style>
      pre {
        background: rgba(15, 23, 42, 0.04);
        padding: 12px;
        border-radius: 14px;
        overflow: auto;
        border: 1px solid rgba(15, 23, 42, 0.10);
      }
      .msg {
        position: static;
        transform: none;
        left: auto;
        top: auto;
        animation: none;
        max-width: none;
        width: 100%;
        box-shadow: none;
        border-color: rgba(37, 99, 235, 0.25);
        background: rgba(37, 99, 235, 0.08);
      }
    </style>
  </head>
  <body>
    <header class="topbar">
      <div class="container topbar-inner">
        <div class="brand" aria-label="Servforce Quiz 管理后台">
          <span class="brand-badge" aria-hidden="true"></span>
          <span>Servforce Quiz</span>
        </div>
        <nav class="nav" aria-label="主导航">
          <a class="nav-link" href="/admin#tab-exams"><span class="nav-ico exams" aria-hidden="true"></span>试卷管理</a>
          <a class="nav-link" href="/admin/candidates"><span class="nav-ico candidates" aria-hidden="true"></span>候选人管理</a>
          <a class="nav-link active" href="/admin#tab-assign"><span class="nav-ico assign" aria-hidden="true"></span>答题邀请</a>
          <a class="nav-link" href="/admin#tab-logs"><span class="nav-ico logs" aria-hidden="true"></span>系统日志</a>
          {% set _ss = system_status_summary if system_status_summary else {} %}
          {% set _lvl = _ss.overall_level if _ss and _ss.overall_level else 'ok' %}
          {% set _badge = '' %}
          {% if _lvl == 'warn' %}{% set _badge = '70%' %}{% endif %}
          {% if _lvl == 'danger' %}{% set _badge = '90%' %}{% endif %}
          {% if _lvl == 'critical' %}{% set _badge = '100%' %}{% endif %}
          <a class="nav-link" href="/admin#tab-status"><span class="nav-ico status" aria-hidden="true"></span>系统状态
            <span class="status-badge level-{{ _lvl }}" data-system-status-badge>{{ _badge }}</span>
          </a>
        </nav>
        <form method="post" action="/admin/logout" style="margin:0;">
          <button class="btn btn-danger" type="submit">退出</button>
        </form>
      </div>
    </header>

    <main class="container page">
      <div class="surface" role="region" aria-label="判卷详情">
        <section class="section">
          <div class="section-head">
            <div>
              <h2 class="title">判卷详情</h2>
              <p class="sub">token：<code>{{ assignment.token }}</code></p>
            </div>
            <a class="btn" href="/admin#tab-assign">返回答题邀请</a>
          </div>

          {% set st = (assignment.status or '') %}
          {% if st != 'graded' %}
            <div class="flash msg">
              当前状态：{{ st or 'unknown' }}。判卷结束后才可查看答题结果。
            </div>
          {% else %}
            <details open>
              <summary class="muted" style="cursor:pointer; font-weight:700;">调试信息（JSON）</summary>
              <pre style="margin-top:10px;">{{ assignment | tojson(indent=2) }}</pre>
            </details>
          {% endif %}
        </section>
      </div>
    </main>
    <script src="{{ url_for('static', filename='system_status.js') }}"></script>
  </body>
</html>
